<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBM Quiz Contest - Payment Receipt</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OqRHiWitzprFXgCpHq/2+K6O8QzFwR1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Your existing custom CSS styles, adapted for Bootstrap where necessary */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #e0f7fa 0%, #e8f5e9 50%, #e3f2fd 100%);
            background-attachment: fixed;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
            color: #333;
        }
        .receipt-container {
            max-width: 800px;
            width: 100%;
            background-color: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 0.75rem; /* Equivalent to Bootstrap's rounded-3 or custom radius */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            padding: 2.5rem; /* Equivalent to Bootstrap's p-4 or p-5, custom to match */
            position: relative;
            overflow: hidden;
        }
        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem; /* Bootstrap's mb-4 is 1.5rem, mb-5 is 3rem, custom for 2rem */
            position: relative;
        }
        .header-section .logo {
            width: 80px;
            height: auto;
            border-radius: 12px; /* Tailwind's rounded-xl is 0.75rem, custom for 12px */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .header-section .title {
            text-align: center;
            flex-grow: 1;
            margin-left: 20px;
        }
        .header-section .title h1 {
            font-size: 2.25rem; /* text-4xl equivalent, Bootstrap has display-6 (2.5rem) or custom */
            font-weight: 800; /* font-extrabold equivalent, Bootstrap has fw-bolder */
            color: #1a202c; /* gray-900 equivalent, Bootstrap's text-dark (black) */
            line-height: 1.2;
        }
        .header-section .title p {
            font-size: 1.1rem;
            color: #4a5568; /* gray-700 equivalent, Bootstrap's text-secondary */
        }
        .receipt-info {
            text-align: right;
            font-size: 0.9rem;
            margin-left: auto; /* Push to the right */
            white-space: nowrap;
        }
        .receipt-info strong {
            display: block;
            font-size: 1.1rem;
            color: #000;
        }
        .divider {
            border-bottom: 2px solid #000;
            margin-bottom: 1.5rem; /* Bootstrap's mb-4 */
        }
        .section-title {
            font-size: 1.3rem;
            font-weight: bold;
            text-align: center;
            padding: 0.75rem 0;
            border-top: 1px solid #000;
            border-bottom: 1px solid #000;
            background-color: #f0f0f0; /* Light grey */
            margin-bottom: 1.5rem; /* Bootstrap's mb-4 */
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem; /* Bootstrap's g-4 or custom */
            margin-bottom: 2rem; /* Bootstrap's mb-4 is 1.5rem, mb-5 is 3rem, custom for 2rem */
        }
        .info-item p {
            margin-bottom: 0.25rem;
            font-size: 0.95rem;
        }
        .info-item strong {
            font-weight: 600;
            color: #1a202c;
        }
        /* Dotted line and flex-middle are custom and can remain */
        .dotted-line {
            border-bottom: 1px dotted #888;
            flex-grow: 1;
            margin-left: 0.5rem;
        }
        .flex-middle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .amount-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-top: 1px solid #ddd;
            font-size: 1.1rem;
            font-weight: bold;
        }
        .signature-line {
            text-align: right;
            margin-top: 3rem; /* Bootstrap's mt-5 */
            font-size: 0.95rem;
        }
        .signature-line p {
            border-top: 1px solid #000;
            display: inline-block;
            padding-top: 0.25rem;
            width: 200px;
            text-align: center;
            margin-top: 0.5rem;
        }
        .print-button-container {
            text-align: center;
            margin-top: 2rem; /* Bootstrap's mt-4 is 1.5rem, mt-5 is 3rem, custom for 2rem */
        }

        /* Specific styles for message display in error cases in JS */
        .alert-error {
            color: #dc3545; /* Bootstrap's danger color */
            font-weight: 600; /* Bootstrap's fw-semibold */
        }
        .alert-info {
            color: #6c757d; /* Bootstrap's secondary color */
        }

        /* Print styles */
        @media print {
            body {
                background: none;
                min-height: auto;
                padding: 0;
                display: block;
            }
            .receipt-container {
                box-shadow: none;
                border: none;
                padding: 0;
            }
            .print-button-container {
                display: none;
            }
        }
        /* Responsive styles */
        @media (max-width: 768px) {
            .header-section {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            .header-section .title {
                margin-left: 0;
                margin-top: 1rem;
            }
            .receipt-info {
                text-align: center;
                margin-top: 1rem;
                margin-left: 0;
            }
            .info-grid {
                grid-template-columns: 1fr;
            }
            .receipt-container {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="receipt-container">
        <div class="header-section">
            <img src="MBM logo.png" alt="Company Logo" class="logo" onerror="this.onerror=null;this.src='https://placehold.co/80x80/ADD8E6/000000?text=LOGO';">
            <div class="title">
                <h1 class="display-6 fw-bolder">10th MBM Quiz Contest 2025</h1>
                <p class="lead text-secondary">Team Application Fee Receipt</p>
                <p class="small text-muted mt-1">Organised by: MBM News Network</p>
            </div>
            <div class="receipt-info">
                <span>Receipt No: </span><strong id="receiptNo">N/A</strong>
                <span>Date: </span><span id="receiptDate">N/A</span>
            </div>
        </div>

        <div class="divider"></div>

        <div class="section-title">PAYMENT DETAILS</div>

        <div class="info-grid">
            <div class="info-item">
                <p><strong>Paid For:</strong> Quiz Contest Team Application</p>
                <p><strong>Category:</strong> <span id="category">N/A</span></p>
                <p><strong>Exam Centre:</strong> <span id="examCentre">N/A</span></p>
            </div>
            <div class="info-item">
                <p><strong>Transaction ID:</strong> <span id="paymentId">N/A</span></p>
                <p><strong>Payment Status:</strong> <span id="paymentStatus" class="fw-bold">N/A</span></p>
                <p><strong>Mode of Payment:</strong> <span id="modeOfPayment">N/A</span></p>
            </div>
        </div>

        <div class="section-title">PARTICIPANT DETAILS</div>

        <div class="info-grid">
            <div class="info-item">
                <p><strong>Participant 1 Name:</strong> <span id="p1Name">N/A</span></p>
                <p><strong>Class:</strong> <span id="p1Class">N/A</span></p>
                <p><strong>School:</strong> <span id="p1School">N/A</span></p>
                <p><strong>Mobile No.:</strong> <span id="p1ParentMob">N/A</span></p>
            </div>
            <div class="info-item">
                <p><strong>Participant 2 Name:</strong> <span id="p2Name">N/A</span></p>
                <p><strong>Class:</strong> <span id="p2Class">N/A</span></p>
                <p><strong>School:</strong> <span id="p2School">N/A</span></p>
                <p><strong>Mobile No.:</strong> <span id="p2ParentMob">N/A</span></p>
            </div>
        </div>

        <div class="amount-details">
            <span>Amount Received:</span>
            <span><strong>â‚¹ <span id="amountReceived">N/A</span></strong></span>
        </div>

        <div class="signature-line">
            <p>Signature of MBM representative</p>
        </div>
    </div>

    <div class="print-button-container">
        <button onclick="window.print()" class="btn btn-primary shadow-sm me-3">
            Print Receipt
        </button>
        <a href="index.html" class="btn btn-secondary shadow-sm">
            Go Back Home
        </a>
    </div>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">


<script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const SUPABASE_URL = 'https://clljwlczkcrpalwedxxq.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsbGp3bGN6a2NycGFsd2VkeHhxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkxNDgwMjgsImV4cCI6MjA2NDcyNDAyOH0.6u9C0Cx0j3F8cQSILlA56pY4rgb-L18R8ukOxk5Osck';

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    document.addEventListener('DOMContentLoaded', async () => {
        const params = new URLSearchParams(window.location.search);
        const paymentIdFromURL = params.get('payment_id');

// If coming from Razorpay payment
if (paymentIdFromURL) {
    const formData = JSON.parse(sessionStorage.getItem('quizFormData')) || {};
    setText('paymentId', paymentIdFromURL);
    setText('paymentStatus', 'PAID âœ…');
    setText('modeOfPayment', 'Online (Razorpay)');
}

        const serialNumber = params.get('serialNumber');

        if (!serialNumber) {
            showError("No application details found.", "Please submit the form first to generate a receipt.");
            return;
        }

        try {
            const { data, error } = await supabase
                .from('quiz_applications')
                .select('*')
                .eq('form_serial_number', serialNumber)
                .single();

            if (error || !data) {
                showError(
                    "Error: Could not load receipt details.",
                    "Please ensure the correct serial number is in the URL and that Supabase RLS policies allow anonymous reads from 'quiz_applications'."
                );
                return;
            }

            // Fill receipt fields
            setText('receiptNo', data.form_serial_number);
            setText('receiptDate', new Date().toLocaleDateString('en-IN', {
                year: 'numeric', month: 'long', day: 'numeric'
            }));

            setText('category', capitalize(data.category));
            setText('examCentre', capitalize(data.exam_centre));
            setText('paymentId', data.payment_id);
            setText('paymentStatus', formatStatus(data.payment_status));

            // Payment mode
            const mode = ['paid', 'simulated_paid'].includes(data.payment_status) ? 'Online (UPI/Card)' : 'N/A';
            setText('modeOfPayment', mode);

            applyStatusClass('paymentStatus', data.payment_status);

            setText('p1Name', data.p1_name);
            setText('p1Class', data.p1_class);
            setText('p1School', data.p1_school);
            setText('p1ParentMob', data.p1_parent_mob);

            setText('p2Name', data.p2_name);
            setText('p2Class', data.p2_class);
            setText('p2School', data.p2_school);
            setText('p2ParentMob', data.p2_parent_mob);

            setText('amountReceived', data.payment_amount ? parseFloat(data.payment_amount).toFixed(2) : 'N/A');

        } catch (err) {
            console.error('Failed to display receipt:', err);
            showError("Error: An unexpected error occurred while generating your receipt.",
                "Please check the console for more details or try again.");
        }
    });

    // Helpers
    function setText(id, text) {
        document.getElementById(id).textContent = text || 'N/A';
    }

    function capitalize(str) {
        return str ? str.charAt(0).toUpperCase() + str.slice(1) : 'N/A';
    }

    function formatStatus(status) {
        return status ? status.replace(/_/g, ' ').toUpperCase() : 'N/A';
    }

    function applyStatusClass(id, status) {
        const el = document.getElementById(id);
        el.classList.remove('text-success', 'text-warning', 'text-danger');

        if (['paid', 'simulated_paid'].includes(status)) {
            el.classList.add('text-success');
        } else if (['unpaid', 'pending'].includes(status)) {
            el.classList.add('text-warning');
        } else {
            el.classList.add('text-danger');
        }
    }

    function showError(title, description) {
        document.body.innerHTML = `
            <div class="container text-center mt-5">
                <p class="text-danger fs-4 fw-bold">${title}</p>
                <p class="text-muted mt-2">${description}</p>
                <div class="mt-4">
                    <a href="index.html" class="btn btn-secondary shadow-sm">Go Back Home</a>
                </div>
            </div>
        `;
    }
</script>

</body>
</html>